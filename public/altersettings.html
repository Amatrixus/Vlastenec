<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VLASTENEC</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="home.css">
</head>
<body>
  <div id="background-layer"></div>
  <div id="cover"></div>
  <div class="glow-behind"></div>

  <div id="wrapper">
    <main id="main-layout">


         <div id="logintile">
            <img id="loginavatar" src="avatar.png">
            <div id="logintext">Přihlásit se</div>
        

      </div>
      



      <div class="left-column">
        <h1>VLASTENEC</h1>
        <p class="tagline">Vyber si témata a nastav hru.</p><br>
        


            <div id="lobbychat">
                
                <div id="lobbyheadline">Lobby chat</div>
                <div id="lobbybody"></div>
                


            </div>



            <div id="settings">


                    <div class="player-info">
                            <div id="playerheadline">Jméno</div>
                            <input type="text" id="playerName" placeholder="Zadejte jméno">

                            <div>
                            <small>
                                Chceš si ukládat výhry? <a href="#" id="loginPrompt">Přihlas se</a>.
                            </small>
                            </div>
                    </div>

                    <div class="mode-settings">
                            
                        <div id="selectmode">
                        <label class="mode-option">
                            <input type="radio" name="gameMode" value="random" />
                            <img src="randomfull.png" id="randomselect" class="selectmodepic" alt="Náhodně" />
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="gameMode" value="friends" />
                            <img src="friendsfull.png" class="selectmodepic" alt="Přátelé" />
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="gameMode" value="bots" />
                            <img src="botsfull.png" class="selectmodepic" alt="Boti" />
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="gameMode" value="liga" />
                            <img src="ligafull.png" id="ligaselect" class="selectmodepic" alt="Liga" />
                        </label>
                        </div>
<div id="modeTitle">Hra s přáteli</div>
                            <p id="modeDescription">
                                Vytvoř místnost a sdílej odkaz s přáteli. Hrajte spolu, kdo zná víc!
                            </p>

                        
                            <div id="shareLink" class="hidden">
                             
                                <input type="text" readonly id="roomLink">
                                
                                <button id="copyLinkBtn">Generovat odkaz</button>
                            </div>
                    </div>

                    <div class="actions">
                    <button id="startBtn">Spustit hru</button>
                    
                    </div>

                    
            </div>

            <div id="catsblock">

                    <div id="catsheadline">Kategorie</div>
                    <div id="cattiles">
                                        <label class="tile">
                                    <input type="checkbox" name="cat1" checked>
                                    <img src="tiles/tile1.png" alt="Tile 1">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Přírodní vědy</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat2" checked>
                                    <img src="tiles/tile2.png" alt="Tile 2">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Jazyk a literatura</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat3" checked>
                                    <img src="tiles/tile3.png" alt="Tile 1">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Technologie</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat4" checked>
                                    <img src="tiles/tile4.png" alt="Tile 2">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Geografie</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat5" checked>
                                    <img src="tiles/tile5.png" alt="Tile 1">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Historie</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat6" checked>
                                    <img src="tiles/tile6.png" alt="Tile 2">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Kultura a umění</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat7" checked>
                                    <img src="tiles/tile7.png" alt="Tile 1">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Sport</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat8" checked>
                                    <img src="tiles/tile8.png" alt="Tile 2">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Osobnosti</span>
                                </label><label class="tile">
                                    <input type="checkbox" name="cat9" checked>
                                    <img src="tiles/tile9.png" alt="Tile 9">
                                    <span class="checkmark"></span>
                                    <span class="tooltip">Politika</span>
                                </label>

                        </div>
                        

            </div>

        
      </div>

      
      
    </main>

   


    
  </div>
</body>
</html>

<script>
(() => {

  // --- jednoslovné slugy kategorií (1..9 dle dlaždic zleva doprava) ---
  const CATEGORY_SLUGS = [
    'vedy', 'literatura', 'technologie', 'geografie', 'historie',
    'kultura', 'sport', 'osobnosti', 'politika'
  ];



  // --- DOM refs ---
  const titleEl = document.getElementById('modeTitle');
  const descEl  = document.getElementById('modeDescription');
  const shareEl = document.getElementById('shareLink');
  const nameEl  = document.getElementById('playerName');
  const startEl = document.getElementById('startBtn');
  const radios  = document.querySelectorAll('#selectmode input[type="radio"][name="gameMode"]');
  const roomInput = document.getElementById('roomLink');
  const copyBtn   = document.getElementById('copyLinkBtn');

  const GAME_URL_BASE = `${window.location.origin}/game_online.html`;

  // --- texty módů ---
  const MODES = {
    random:  { title: 'Náhodný soupeř',  desc: 'Najdi protivníka z celé republiky a poměřte znalosti!', share: false },
    friends:{ title: 'Hra s přáteli',    desc: 'Vytvoř místnost a sdílej odkaz s přáteli. Hrajte spolu, kdo zná víc!', share: true },
    bots:   { title: 'Hra proti botům',  desc: 'Trénuj proti chytrým botům a zlepšuj se bez stresu.',   share: false },
    liga:   { title: 'Liga',             desc: 'Sbírej body do ligy a vyšplhej se v žebříčku.',         share: false }
  };

  // --- stav ---
  let currentRoomCode = null;

  // --- pomocné ---
  function currentModeKey() {
    const r = [...radios].find(x => x.checked);
    return r ? r.value : null;
  }

  function applyMode(modeKey) {
    const m = MODES[modeKey];
    if (!m) return;
    titleEl.textContent = m.title;
    descEl.textContent  = m.desc;

    if (m.share) {
      shareEl.classList.remove('hidden');
    } else {
      shareEl.classList.add('hidden');
      currentRoomCode = null;
      if (roomInput) roomInput.value = '';
    }
  }

  function genRoomCode(len = 6) {
    if (window.crypto?.getRandomValues) {
      const arr = new Uint8Array(len);
      crypto.getRandomValues(arr);
      const alphabet = 'abcdefghijklmnopqrstuvwxyz0123456789';
      return Array.from(arr, n => alphabet[n % alphabet.length]).join('');
    }
    return Math.random().toString(36).slice(2, 2 + len);
  }

  // --- share link pro přátele (jen ?mode=friends&room=CODE) ---
  copyBtn?.addEventListener('click', async () => {
    currentRoomCode = genRoomCode();
    const link = `${GAME_URL_BASE}?mode=friends&room=${currentRoomCode}`;
    roomInput.value = link;

    try {
      await navigator.clipboard.writeText(link);
      copyBtn.textContent = 'Zkopírováno ✓';
      setTimeout(() => (copyBtn.textContent = 'Generovat odkaz'), 1500);
    } catch {
      copyBtn.textContent = 'Zkopíruj ručně';
      setTimeout(() => (copyBtn.textContent = 'Generovat odkaz'), 1500);
    }
  });

  // Přepínání módů (barva/šedá řeší CSS přes :checked)
  radios.forEach(r => r.addEventListener('change', () => applyMode(r.value)));

  // --- počáteční mód z URL (fallback na 'random') ---
  const defaultMode = 'random';
  const qp = new URLSearchParams(location.search);
  const urlMode = (qp.get('mode') || '').toLowerCase();
  const allowedModes = new Set(['random','friends','bots','liga']);
  const initialMode = allowedModes.has(urlMode) ? urlMode : defaultMode;

  const initialRadio = [...radios].find(r => r.value === initialMode) || radios[0];
  if (initialRadio) { initialRadio.checked = true; applyMode(initialRadio.value); }

  // --- sběr kategorií ---
  function getSelectedCategories() {
    const labels = document.querySelectorAll('#cattiles label.tile');
    const picked = [];
    labels.forEach((lab, idx) => {
      const cb = lab.querySelector('input[type="checkbox"]');
      if (cb && cb.checked) {
        // do URL posíláme jednoslovné slugy odpovídající DB
        const slug = CATEGORY_SLUGS[idx] || `cat${idx+1}`;
        picked.push({ id: (idx+1), name: slug });
      }
    });
    return picked;
  }

  // --- odeslání do game_online.html ---
  startEl.addEventListener('click', () => {
    const name = (nameEl.value || '').trim();
    const mode = currentModeKey();
    const cats = getSelectedCategories();

    if (!name) { alert('Zadej prosím jméno hráče.'); nameEl.focus(); return; }
    if (!mode) { alert('Vyber prosím herní režim.'); return; }
    if (cats.length === 0) { alert('Vyber aspoň jednu kategorii.'); return; }

    const params = new URLSearchParams();
    params.set('name', name);
    params.set('mode', mode);
    params.set('cats', cats.map(c => c.id).join(','));
    // POZN.: URLSearchParams sám encoduje, takže už NEvoláme encodeURIComponent.
    // Klidně posílejme jednoduchý CSV se slugy – čitelné a stabilní pro server/DB.
    params.set('catnames', JSON.stringify(cats.map(c => c.name)));


    if (mode === 'friends') {
      if (!currentRoomCode) {
        currentRoomCode = genRoomCode();
        if (roomInput) roomInput.value = `${GAME_URL_BASE}?mode=friends&room=${currentRoomCode}`;
      }
      params.set('room', currentRoomCode);
    }

    window.location.href = `${GAME_URL_BASE}?${params.toString()}`;
  });

  // Enter v poli Jméno spustí hru
  nameEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') startEl.click();
  });
})();
</script>
